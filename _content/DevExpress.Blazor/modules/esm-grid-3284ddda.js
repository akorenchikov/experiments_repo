import{B as e}from"./esm-chunk-d81494b9.js";import{attachEventToElement as t,detachEventFromElement as o,findParentBySelector as n,getParentByClassName as l,getDocumentScrollTop as i,getDocumentScrollLeft as r,elementIsInDOM as s,querySelectorFromRoot as c,ensureElement as u,getLeftRightBordersAndPaddingsSummaryValue as a,getCurrentStyleSheet as d,subscribeElementContentSize as f,getTopBottomBordersAndPaddingsSummaryValue as p,unsubscribeElement as g,getEventSource as h}from"./esm-dom-utils-88a2c0cb.js";import{d as m,r as y}from"./esm-chunk-fc46b9cc.js";import{T as H}from"./esm-chunk-639f7231.js";import{g as S}from"./esm-chunk-13e2cf5f.js";const x=".dxbs-table td.table-active",b=".dropdown-item.active",T=".dropdown-item.focused",w={GroupPanelHead:"gph",ColumnHead:"ch"};function v(e){if(!e.hasAttribute("data-dxdg-draggable"))return null;const t=e.getAttribute("data-dxdg-draggable").split("|"),o=!(t.length>2)||"1"===t[2],n=t.length>1?w[t[1]]:w.ColumnHead,l=n===w.ColumnHead?parseInt(t[0]):-1,i=n===w.GroupPanelHead?parseInt(t[0]):-1,r=e.previousElementSibling;return{columnVisibleIndex:l,groupVisibleIndex:i,columnHeadType:n,canBeGrouped:o,needInsertBeforeToo:!r||!v(r),element:e}}function I(e){return"[data-dxdg-draggable-id="+e+"]"}function R(e,t,o){var n,l,i;n=e,l=E(t,"clientX")-o.left,i=E(t,"clientY")-o.top,void(n.style.transform=["translate(",Math.round(l),"px, ",Math.round(i),"px)"].join(""))}function E(e,t){return void 0!==e[t]?e[t]:void 0!==e.touches?e.touches[0][t]:0}function N(s,c,u){const a=E(s,"clientX"),d=E(s,"clientY"),f=s.target;let p=!1;const g=function(e){const s=Math.abs(a-E(e,"clientX"))>10,g=Math.abs(d-E(e,"clientY"))>10;return(s||g)&&(p=!0,h(),function(e,s,c,u){const a=I(c),d=n(s,a);if(!d)return;const f=l(d,"dxbs-gridview").getBoundingClientRect(),p=v(d),g=r(),h=i();let m={left:0,top:0};const y=function(e,t){const o=[],n=I(t),l=document.querySelectorAll(n);let i=!1,r=!1;for(let e=0;e<l.length;e++){const t=l[e],n=t.getBoundingClientRect(),s=v(t),c=s.columnVisibleIndex,u=s.groupVisibleIndex,a=s.columnHeadType;a===w.GroupPanelHead?i=!0:a===w.ColumnHead&&(r=!0),s.needInsertBeforeToo&&o.push(new q(t,n.left,n.top,n.bottom,c,u,a,!0,!1)),o.push(new q(t,n.right,n.top,n.bottom,c,u,a,!1,!1))}if(i||r){if(!i){const e=document.querySelector("[data-dxdg-drag-group-panel="+t+"]");if(e){const t=e.getBoundingClientRect();o.push(new q(e,t.left,t.top,t.bottom,-1,0,w.GroupPanelHead,!1,!0,!0))}}if(!r){const e=document.querySelector("[data-dxdg-drag-head-row="+t+"]");if(e){const t=e.getBoundingClientRect();o.push(new q(e,t.right,t.top,t.bottom,-1,-1,w.ColumnHead,!1,!0,!0))}}}return o}(0,c),S=function(e,t){let o=e.cloneNode(!0);const n=e.getBoundingClientRect(),l={left:E(t,"clientX")-n.left,top:E(t,"clientY")-n.top};if("DIV"!==o.tagName){const t=document.createElement("DIV"),l=window.getComputedStyle(e);t.innerHTML=o.innerHTML,t.className="card "+e.className,t.style.width=n.width+"px",t.style.height=n.height+"px",t.style.paddingTop=l.paddingTop,t.style.paddingBottom=l.paddingBottom,t.style.paddingLeft=l.paddingLeft,t.style.paddingRight=l.paddingRight,o=t}else o.style.width=n.width+"px",o.style.height=n.height+"px";o.className=o.className+" dx-dragging-state",document.body.appendChild(o);const i=o.getBoundingClientRect();return{dragElement:o,offsetFromMouse:{left:i.left+l.left,top:i.top+l.top}}}(d,e),x=S.dragElement,b=S.offsetFromMouse;R(x,e,b);let T=!0,N=null;const M=function(e){T&&(x.style.visibility="visible",T=!1);return R(x,e,{left:b.left+m.left,top:b.top+m.top}),N=function(e,t,o,n,l,s){!function(e){const t=I(e),o=document.querySelectorAll("div.dxgv-target-marks"+t);for(let e=0;e<o.length;e++){const t=o[e];t.parentNode.removeChild(t)}}(t);let c=null;const u=[],a=E(n,"clientX"),d=E(n,"clientY");for(let t=0;t<e.length;t++){const n=e[t];if(n.columnHeadType===w.GroupPanelHead&&!o.canBeGrouped)continue;if(n.top+l.top<=d&&d<=n.bottom+l.top){if(n.wholeRowIsRarget){c=n;break}u.push({distance:Math.abs(Math.abs(n.x+l.left)-Math.abs(a)),target:n})}}if(null==c){let e=1e6;for(const t in u)e>u[t].distance&&V(a,o,u[t].target)&&(e=u[t].distance,c=u[t].target)}null==c||B(o,c)||c.x>=s.left&&c.x<=s.right&&!function(e,t){const o=document.createElement("DIV");o.className="dxgv-target-marks",o.dataset.dxdgDraggableId=t,o.style.top=e.top+(e.docScrollTop-i())+i()-1-1+"px",o.style.height=e.bottom-e.top+2+"px",o.style.left=e.x+(e.docScrollLeft-r())+r()+"px",o.innerHTML=["<span class='oi oi-arrow-bottom' aria-hidden='true'></span>","<div style='height:",o.style.height,"'></div>","<span class='oi oi-arrow-top' aria-hidden='true'></span>"].join(""),document.body.appendChild(o),e.mark=o}(c,t);return c}(y,c,p,e,m,f),e.preventDefault(),!1},C=function(){if(N&&!B(p,N)){u.invokeMethodAsync("OnGridColumnHeadDragNDrop",p.columnHeadType===w.GroupPanelHead?p.groupVisibleIndex:p.columnVisibleIndex,p.columnHeadType,N.columnHeadType===w.GroupPanelHead?N.groupVisibleIndex:N.columnVisibleIndex,N.columnHeadType,N.insertBefore),N.mark&&N.mark.parentNode.removeChild(N.mark)}o(document,H.touchMouseMoveEventName,M),o(document,H.touchMouseUpEventName,C),o(window,"scroll",L),x.parentNode.removeChild(x)},L=function(){m={left:g-r(),top:h-i()}};t(document,H.touchMouseMoveEventName,M),t(document,H.touchMouseUpEventName,C),t(window,"scroll",L)}(e,f,c,u)),e.preventDefault(),!1},h=function(){o(document,H.touchMouseMoveEventName,g),o(document,H.touchMouseUpEventName,h),!p&&f&&e.WebKitTouchUI&&f.click()};return t(document,H.touchMouseMoveEventName,g),t(document,H.touchMouseUpEventName,h),s.preventDefault(),f.focus(),!1}function q(e,t,o,n,l,s,c,u,a){this.element=e,this.x=t,this.top=o,this.bottom=n,this.columnVisibleIndex=l,this.groupVisibleIndex=s,this.columnHeadType=c,this.insertBefore=u,this.wholeRowIsRarget=a,this.docScrollTop=i(),this.docScrollLeft=r()}function B(e,t){function o(e,t){return t.groupVisibleIndex===e.groupVisibleIndex||t.groupVisibleIndex===e.groupVisibleIndex-1&&!t.insertBefore}function n(e,t){return t.columnVisibleIndex===e.columnVisibleIndex||t.columnVisibleIndex===e.columnVisibleIndex-1&&!t.insertBefore}if(t.columnHeadType===e.columnHeadType&&e.columnHeadType===w.GroupPanelHead&&o(e,t))return!0;if(t.columnHeadType===e.columnHeadType&&e.columnHeadType===w.ColumnHead&&n(e,t))return!0;if(e.columnHeadType===w.GroupPanelHead&&t.columnHeadType===w.ColumnHead&&-1!==e.columnVisibleIndex&&n(e,t))return!0;return!(e.columnHeadType!==w.ColumnHead||t.columnHeadType!==w.GroupPanelHead||-1===e.groupVisibleIndex||!o(e,t))}function V(e,t,o){const n=t.element.getBoundingClientRect();if(B(t,o)&&(e<n.left||e>n.right))return!1;if(o.x<n.left){if(e>n.right)return!1}else if(e<n.left)return!1;return!0}w[1]=w.ColumnHead,w[0]=w.GroupPanelHead;class M{constructor(e,t,o){this._itemHeight=e,this._scrollTop=t,this._scrollHeight=o}get itemHeight(){return this._itemHeight}get scrollTop(){return this._scrollTop}get scrollHeight(){return this._scrollHeight}isEqual(e){return this.itemHeight===e.itemHeight&&this.scrollTop===e.scrollTop&&this.scrollHeight===e.scrollHeight}}function C(e){if(!s(e))return;let t=function(e){let t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){let e=t.querySelector(b);if(e||(e=t.querySelector(x)),e)return e.parentNode}return null}(e);if(t||(t=function(e){let t=null;c(e,(function(o){t=e.querySelector("*"+o+" > *[id$='_LB']")})),t||c(e.parentNode,(function(o){t=e.parentNode.querySelector("*"+o+" > *[id$='_LB']")}));const o=t?t.querySelector(x):null;return o?o.parentNode:null}(e)),t){const o=e;let n=t.offsetTop;if("TABLE"===t.offsetParent.tagName){const e=t.offsetParent.previousElementSibling;e&&(n+=e.clientHeight)}const l=o.scrollTop+o.clientHeight<n+t.offsetHeight;o.scrollTop>n&&(o.scrollTop=n),l&&(o.scrollTop=n-(o.clientHeight-t.offsetHeight))}}function L(e){if(!s(e))return;const t=function(e){let t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){const e=t.querySelector(T);if(e)return"TR"===e.tagName?e:e.parentNode}return null}(e);if(t){let o=e.querySelector(".dxgvCSD");o||(o=e);const n=o.scrollTop+o.clientHeight<t.offsetTop+t.offsetHeight;o.scrollTop>t.offsetTop&&(o.scrollTop=t.offsetTop),n&&(o.scrollTop=t.offsetTop-(o.clientHeight-t.offsetHeight))}}function D(e){void 0===e.dataset.virtualScrollLock&&(e.dataset.virtualScrollLock=0)}function k(e){D(e),e.dataset.virtualScrollLock++}function A(e){D(e),e.dataset.virtualScrollLock--}function W(e,t,o,n,l,i,r){o.isHorizontalScrolling&&!function(e,t,o){if(t.scrollLeft===o.scrollLeft)return;const n=h(e);n===t?o.scrollLeft=t.scrollLeft:n===o&&setTimeout(()=>t.scrollLeft=o.scrollLeft,0)}(e,n,l),o.isVirtualScrolling&&function(e,t,o,n,l){if(i=o,D(i),i.dataset.virtualScrollLock>0)return;var i;!function(e,t,o,n,l){let i=!0;o.dataset.prevScrollTop?i=o.dataset.prevScrollTop!==o.scrollTop.toString():o.dataset.prevScrollTop=o.scrollTop;G(o),i&&(o.dataset.OnScrollTimerId=setTimeout((function(){!function(e,t,o,n,l){const i=P(t),r=U(t,l),s=r.scrollTop,c=r.scrollBottom,u=n.clientHeight>0&&c>o.offsetHeight+i.offsetHeight;(o.clientHeight>0&&s<o.offsetHeight||u)&&!function(e,t,o){if(e.dxScrollStateCache&&e.dxScrollStateCache.isEqual(o))return;e.dxScrollStateCache=o,t.DxRestoreScrollTop=t.scrollTop,k(t),e.invokeMethodAsync("OnGridVirtualScroll",o.itemHeight,o.scrollTop,o.scrollHeight).then(o=>{!function(e,t){Z(e.mainElement,e,t)}(o,e),A(t)}).catch(z)}(e,t,r.requestScrollState)}(e,o,n,l,!1),t.needInternalSettings&&$(t)}),200))}(e,t,o,n,l)}(t,o,n,i,r)}function G(e){e.dataset.OnScrollTimerId&&(clearTimeout(e.dataset.OnScrollTimerId),delete e.dataset.OnScrollTimerId)}function P(e){const t=e.querySelector("table.dxbs-table"),o=e.parentNode.querySelector("div.dxbs-listbox > ul");return t||o}function _(e,t,o,n,l){const i=P(t),r=function(e,t){const o=O(e);return{itemHeight:o,spacerTop:t.virtualScrollingOptions.itemsAbove*o,spacerBelow:t.virtualScrollingOptions.itemsBelow*o}}(i,l);o.style.height=r.spacerTop+"px",n.style.height=r.spacerBelow+"px",function(e,t,o,n){if(e.clientHeight>t.offsetHeight)return;e.scrollTop<o.clientHeight&&(e.scrollTop=o.clientHeight+1);e.scrollTop+e.clientHeight>o.clientHeight+t.offsetHeight&&(e.scrollTop=o.clientHeight+t.offsetHeight-e.clientHeight-1)}(t,i,o)}function O(e){const t=function(e){let t=[];return e.dataset.tempUniqueId="tempUniqueId","TABLE"===e.tagName?t=e.parentNode.querySelectorAll("TABLE[data-temp-unique-id] > TBODY > TR"):"UL"===e.tagName&&(t=e.parentNode.querySelectorAll("ul[data-temp-unique-id] > li")),delete e.dataset.tempUniqueId,t}(e),o={};for(let e=0;e<t.length;e++){const n=t[e];o[n.offsetHeight]=o[n.offsetHeight]?o[n.offsetHeight]+1:1}let n=0,l=0;for(const e in o)o[e]>l&&(l=o[e],n=e);return Number.parseInt(n)}function X(e){return null!==P(e)}function U(e,t){let o=300,n=300;t&&(o=0,n=0);const l=P(e);let i=e.scrollTop-o;i<0&&(i=0);const r=e.scrollTop+e.clientHeight+n;let s=i-o;s<0&&(s=0);const c=r-s+n,u=O(l);return{scrollTop:i,scrollBottom:r,requestScrollState:new M(u,s,c)}}function z(e){e&&e.mainElement&&ee(e.mainElement)}function j(e,t){return(t.isVerticalScrolling||t.isVirtualScrolling)&&(e.clientHeight<e.scrollHeight||"scroll"===e.style.overflowY)}function Y(e){return function(){if(!e.ownerStyleSheet)return;const t=e.parentStyleSheet,o=Array.prototype.indexOf.call(t.cssRules,e);o>-1&&t.deleteRule(o)}}function $(e){const t=e.elementsStorage,o=u(e.mainElement).parentElement;if(!o)return;const n=u(t.scrollElement),l=u(t.scrollHeaderElement),i=[],r=window.getComputedStyle(o);if(r){if(!n.style.maxHeight)if(e.isDropDown)n.style.maxHeight=K(r,l)+"px";else{const e=f(o,e=>{n.style.maxHeight=e.height-l.offsetHeight+"px"}),t=f(l,e=>{n.style.maxHeight=o.clientHeight-(e.height+2*p(l))+"px"});i.push((function(){g(e),g(t)})),n.style.maxHeight=o.clientHeight-l.offsetHeight+"px"}if(e.isDropDown&&2!==e.dropDownWidthMode){const t=F(n,l,o,e.mainElement,e.dropDownWidthMode,r),s=n.querySelector("table");if(!s)return;y(s,(function(){t&&t()}));const c=f(s,t=>{m(s);const i=F(n,l,o,e.mainElement,e.dropDownWidthMode,r);y(s,(function(){i&&i()}))});i.push((function(){g(c),m(s)}))}return i.length>0?function(){i.forEach(e=>e())}:null}}function F(e,t,o,n,i,r){function s(e,t){const o=e.querySelector(t);return o?o.children:null}let c=null;const a=e.querySelector("table"),f=t.querySelector("table");if(!a||!f)return;const p=s(a,"tbody>tr"),g=p&&1===p.length&&a.querySelector("tr.dxbs-empty-data-row"),h=s(f,"colgroup"),m=s(a,"colgroup");o.dataset.calculated&&Q(h,m);let y=0;if(g){f.style.width="auto";const e=window.getComputedStyle(f).width;f.removeAttribute("style"),y=parseFloat(e,10)}else{const e=s(f,"thead>tr");if(!(h&&e&&p&&m))return;a.style.width=f.style.width="auto";const t=[];for(let o=0;o<h.length;o++)if(h[o].style.width)if(-1!==h[o].style.width.indexOf("%"))t.push(o);else{const e=d(),t=u(n).getAttribute("data-dxdg-id");let l=null;e&&(e.insertRule("[data-dxdg-id='"+t+"'] table tr>td:nth-child("+(o+1)+"), [data-dxdg-id='"+t+"'] table tr>th:nth-child("+(o+1)+") { max-width:"+h[o].style.width+"; }",e.cssRules.length),l=e.cssRules[e.cssRules.length-1],y+=parseFloat(h[o].style.width,10)),c=Y(l)}else h[o].dataset.autoWidth=!0,y+=J(h[o],m[o],e[o],p[o]);if(t.length>0)for(let o=0;o<t.length;o++)y+=J(h[o],m[o],e[o],p[o]);a.removeAttribute("style"),f.removeAttribute("style")}if(0===i||1===i){const n=l(o,"dx-blazor-multicolumn-editor");if(!n)return;const s=parseInt(r.borderRightWidth,10)+parseInt(r.borderLeftWidth,10),c=y+(e.querySelector("table").offsetHeight>K(r,t)?S():0)+s+1;0===i&&n.offsetWidth>=c?(Q(h,m),o.style.width=n.offsetWidth+"px"):o.style.width=c+"px"}return o.dataset.calculated=!0,c}function K(e,t){const o=parseInt(e.borderTopWidth,10)+parseInt(e.borderBottomWidth,10);return parseInt(e.maxHeight,10)-o-t.offsetHeight}function J(e,t,o,n){const l=o.offsetWidth,i=n.offsetWidth,r=l>i?l:i;return t.style.width=e.style.width=r+"px",r}function Q(e,t){for(let o=0;o<e.length;o++)if(e[o].dataset.autoWidth&&(e[o].style.width=null,t)){const e=t.item(o);e&&(e.style.width=null)}}function Z(e,n,l){const i=u(e);if(!i)return;const r=l,s=n.scrollToSelectedItemRequested,c=n.elementsStorage;let f=u(c.scrollElement),p=u(c.scrollHeaderElement),g=u(c.virtualScrollSpacerTopElement),h=u(c.virtualScrollSpacerBottomElement);m(i);let x=null,b=null,T=null,w=null,v=null;n.needInternalSettings&&(v=$(n)),f=u(f);let I=null;if(f&&(p=u(p),k(f),n.isVirtualScrolling&&(g=u(g),h=u(h)),(n.isVirtualScrolling||n.isVerticalScrolling)&&function(e,t,o){if(!o.isVerticalScrolling&&!o.isVirtualScrolling)return;if(!t)return;const n=[t];if(j(e,o)){const l=17,i=S();if(i!==l||o.isHorizontalScrolling){const e=o.isHorizontalScrolling?"paddingRight":"marginRight",t=o.isHorizontalScrolling?"marginRight":"paddingRight";for(let o=0,l=n.length;o<l;o++)n[o].style[e]="0",n[o].style[t]=i+"px"}else e.style.paddingRight="",e.style.marginRight="",t.style.paddingRight="",t.style.marginRight=""}else e.style.paddingRight="0",e.style.marginRight="0",t.style.paddingRight="0",t.style.marginRight="0"}(f,p,n),n.isVirtualScrolling&&(_(0,f,g,h,n),s?C(f):f.DxRestoreScrollTop&&(f.scrollTop=f.DxRestoreScrollTop,delete f.DxRestoreScrollTop)),I=function(e){const t=e.querySelectorAll(".btn.btn-toggle");let o=0;for(let e=0;e<t.length;e++){const n=t[e],l=n.offsetWidth+a(n.parentNode);if(l>0){o=l;break}}const n=d(),l=e.getAttribute("data-dxdg-id");let i=null;return n&&(n.insertRule("[data-dxdg-id='"+l+"'] > col.dxbs-grid-cols-togglebtn { width:"+o+"px !important; }",n.cssRules.length),i=n.cssRules[n.cssRules.length-1]),Y(i)}(i),x=function(e){return W(e,r,n,f,p,g,h)},t(f,"scroll",x),p&&t(p,"scroll",x),A(f),function(e){return!e.needInternalSettings&&(e.isHorizontalScrolling||e.isVerticalScrolling)}(n))){const e=u(c.rootElement);b=function(){!function(e,t,o,n){let l,i;t&&(k(t),l=t.style.overflowX,t.style.overflowX="hidden",t.style.width="0"),o&&(i=o.style.overflowX,o.style.overflowX="hidden",o.style.width="0");const r=e.clientWidth;if(t&&(r&&(t.style.width=r+"px"),t.style.overflowX=l),o){const e=j(t,n)?S():0;r&&(o.style.width=r-e+"px"),o.style.overflowX=i}t&&A(t)}(e,f,p,n)},b(),t(window,"resize",b)}let R=null,E=null;if(n.isColumnDragEnabled){const e=i.dataset.dxdgId;e&&(R=i.querySelector("[data-dxdg-drag-head-row='"+e+"']"),R&&(T=function(t){return N(t,e,r)},t(R,H.touchMouseDownEventName,T)),E=i.querySelector("[data-dxdg-gp='"+e+"']"),E&&(w=function(t){return N(t,e,r)},t(E,H.touchMouseDownEventName,w)))}return y(i,(function(){I&&I(),v&&v(),x&&(o(f,"scroll",W),p&&o(p,"scroll",W)),b&&o(window,"resize",b),f&&G(f),T&&R&&o(R,H.touchMouseDownEventName,T),w&&E&&o(E,H.touchMouseDownEventName,w)})),Promise.resolve("ok")}function ee(e){return(e=u(e))&&m(e),Promise.resolve("ok")}const te={init:Z,dispose:ee};export default te;export{X as HasParametersForVirtualScrollingRequest,ee as dispose,U as getParametersForVirtualScrollingRequest,Z as init,L as scrollToFocusedItem,C as scrollToSelectedItem};
